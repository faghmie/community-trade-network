<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contractor Reviews</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚≠ê</text></svg>">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <header class="flex-between">
            <div>
                <h1>Contractor Reviews</h1>
                <p>Find and review local contractors</p>
            </div>
            <nav>
                <a href="admin.html" class="btn btn-secondary">
                    <i class="fas fa-cog"></i> Admin Dashboard
                </a>
            </nav>
        </header>

        <!-- Search and Filter Section - UPDATED: Cleaned up compact filters -->
        <section class="dashboard-controls">
            <!-- Compact Filter Bar - UPDATED: Removed ratings and sort to advanced section -->
            <div class="compact-filter-bar">
                <div class="compact-filters">
                    <!-- Integrated Search Box -->
                    <div class="filter-group compact search-integrated">
                        <div class="search-box compact">
                            <input type="text" id="searchInput" placeholder="Search contractors..."
                                class="input search-input compact" data-action="search-keypress">
                            <button class="btn btn-primary btn-small" data-action="search">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <div class="filter-group compact">
                        <select id="locationFilter" class="input filter-select compact" data-action="filter">
                            <option value="">üìç All Locations</option>
                            <!-- Locations will be populated dynamically -->
                        </select>
                    </div>

                    <!-- Action Buttons Group -->
                    <div class="filter-actions compact">
                        <button class="btn btn-outline btn-small" id="toggleFiltersBtn" data-action="toggle-filters">
                            <i class="fas fa-sliders-h"></i> Filters
                            <span class="filter-badge hidden" id="activeFilterCount">0</span>
                        </button>

                        <button class="btn btn-secondary btn-small clear-filters-btn" data-action="clear-filters"
                            title="Clear all filters">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>

                    <!-- View Toggle on right side -->
                    <div class="filter-group compact view-toggle-integrated">
                        <div class="view-toggle compact" id="view-toggle">
                            <button class="view-toggle-btn active" data-view="list" title="List View">
                                <i class="fas fa-list"></i> List
                            </button>
                            <button class="view-toggle-btn" data-view="map" title="Map View">
                                <i class="fas fa-map"></i> Map
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters (Collapsible) - UPDATED: Cleaned up header -->
            <div class="advanced-filters hidden" id="advancedFilters">
                <!-- Quick Preset Buttons - No heading -->
                <div class="quick-presets">
                    <div class="preset-buttons">
                        <button class="btn btn-outline btn-small" data-action="show-favorites">
                            <i class="fas fa-heart"></i> Show Favorites
                        </button>
                        <button class="btn btn-outline btn-small" data-action="show-high-rated">
                            <i class="fas fa-star"></i> Show Top Rated
                        </button>
                    </div>
                </div>

                <div class="advanced-filters-header">
                    <h4>Advanced Filters</h4>
                </div>

                <div class="advanced-filter-grid">
                    <div class="filter-group">
                        <label for="categoryFilter" class="filter-label">
                            <i class="fas fa-tags"></i> Category
                        </label>
                        <select id="categoryFilter" class="input filter-select" data-action="filter">
                            <option value="">All Categories</option>
                            <!-- Categories will be populated dynamically -->
                        </select>
                    </div>

                    <!-- MOVED: Ratings filter to advanced section -->
                    <div class="filter-group">
                        <label for="ratingFilter" class="filter-label">
                            <i class="fas fa-star"></i> Minimum Rating
                        </label>
                        <select id="ratingFilter" class="input filter-select" data-action="filter">
                            <option value="">All Ratings</option>
                            <option value="4.5">4.5+ Stars ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                            <option value="4.0">4.0+ Stars ‚≠ê‚≠ê‚≠ê‚≠ê</option>
                            <option value="3.5">3.5+ Stars ‚≠ê‚≠ê‚≠ê</option>
                            <option value="3.0">3.0+ Stars ‚≠ê‚≠ê</option>
                        </select>
                    </div>

                    <!-- MOVED: Sort filter to advanced section -->
                    <div class="filter-group">
                        <label for="sortBy" class="filter-label">
                            <i class="fas fa-sort"></i> Sort By
                        </label>
                        <select id="sortBy" class="input filter-select" data-action="sort">
                            <option value="name">Name (A-Z)</option>
                            <option value="rating">Highest Rated</option>
                            <option value="reviews">Most Reviews</option>
                            <option value="location">Location</option>
                            <option value="favorites">Favorites First</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="favoritesFilter" class="filter-label">
                            <i class="fas fa-heart"></i> Favorites
                        </label>
                        <select id="favoritesFilter" class="input filter-select" data-action="filter">
                            <option value="">All Contractors</option>
                            <option value="favorites">‚≠ê Favorites Only</option>
                            <option value="non-favorites">Not in Favorites</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="stats-overview">
                <div class="stat-card">
                    <span class="stat-number" id="totalContractorsCount">0</span>
                    <span class="stat-label">Contractors</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalReviewsCount">0</span>
                    <span class="stat-label">Reviews</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="averageRatingCount">0.0</span>
                    <span class="stat-label">Avg Rating</span>
                </div>
                <!-- Favorites Count -->
                <div class="stat-card favorites-stat">
                    <span class="stat-number favorites-count">0</span>
                    <span class="stat-label">Favorites</span>
                </div>
            </div>
        </section>

        <!-- Map Container -->
        <section class="map-section">
            <div id="map-container" class="map-container hidden"></div>
        </section>

        <!-- Favorites Section -->
        <section id="favoritesSection" class="favorites-section hidden">
            <div class="section-header">
                <h2><i class="fas fa-heart favorites-icon"></i> Your Favorite Contractors</h2>
                <span class="favorites-badge">0</span>
            </div>
            <div id="favoritesNotice">
                <!-- Favorites notice will be populated dynamically -->
            </div>
            <div class="grid grid-3" id="favoritesGrid">
                <!-- Favorite contractors will be loaded here -->
            </div>
        </section>

        <!-- Contractor List -->
        <section class="contractor-list" id="contractorList">
            <div class="section-header">
                <h2>Available Contractors</h2>
            </div>
            <div class="grid grid-3" id="contractorsGrid">
                <!-- Contractors will be loaded here -->
            </div>
        </section>

        <!-- Review Form Modal -->
        <div class="modal" id="reviewModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Leave a Review</h2>
                    <span class="close" id="closeModal">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="reviewForm">
                        <input type="hidden" id="contractorId">

                        <div class="form-group">
                            <label for="reviewerName">Your Name:</label>
                            <input type="text" id="reviewerName" class="input" required>
                        </div>

                        <!-- Project Type Only -->
                        <div class="form-group">
                            <label for="projectType">Project Type:</label>
                            <select id="projectType" class="input" required>
                                <option value="">Select Project Type</option>
                                <option value="bathroom-renovation">Bathroom Renovation</option>
                                <option value="kitchen-remodel">Kitchen Remodel</option>
                                <option value="plumbing">Plumbing Work</option>
                                <option value="electrical">Electrical Work</option>
                                <option value="painting">Painting</option>
                                <option value="flooring">Flooring</option>
                                <option value="roofing">Roofing</option>
                                <option value="general-construction">General Construction</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Overall Rating - Separate container -->
                        <div class="form-group">
                            <label>Overall Rating:</label>
                            <div class="star-rating overall-rating">
                                <span class="star" data-rating="1">‚òÖ</span>
                                <span class="star" data-rating="2">‚òÖ</span>
                                <span class="star" data-rating="3">‚òÖ</span>
                                <span class="star" data-rating="4">‚òÖ</span>
                                <span class="star" data-rating="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="rating" required>
                        </div>

                        <!-- Category Ratings - Each with unique class -->
                        <div class="rating-categories">
                            <h4>Rate by Category:</h4>

                            <div class="rating-category">
                                <label>Quality of Work</label>
                                <div class="star-rating quality-rating">
                                    <span class="star" data-rating="1">‚òÖ</span>
                                    <span class="star" data-rating="2">‚òÖ</span>
                                    <span class="star" data-rating="3">‚òÖ</span>
                                    <span class="star" data-rating="4">‚òÖ</span>
                                    <span class="star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="qualityRating" required>
                            </div>

                            <div class="rating-category">
                                <label>Communication</label>
                                <div class="star-rating communication-rating">
                                    <span class="star" data-rating="1">‚òÖ</span>
                                    <span class="star" data-rating="2">‚òÖ</span>
                                    <span class="star" data-rating="3">‚òÖ</span>
                                    <span class="star" data-rating="4">‚òÖ</span>
                                    <span class="star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="communicationRating" required>
                            </div>

                            <div class="rating-category">
                                <label>Timeliness</label>
                                <div class="star-rating timeliness-rating">
                                    <span class="star" data-rating="1">‚òÖ</span>
                                    <span class="star" data-rating="2">‚òÖ</span>
                                    <span class="star" data-rating="3">‚òÖ</span>
                                    <span class="star" data-rating="4">‚òÖ</span>
                                    <span class="star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="timelinessRating" required>
                            </div>

                            <div class="rating-category">
                                <label>Value for Money</label>
                                <div class="star-rating value-rating">
                                    <span class="star" data-rating="1">‚òÖ</span>
                                    <span class="star" data-rating="2">‚òÖ</span>
                                    <span class="star" data-rating="3">‚òÖ</span>
                                    <span class="star" data-rating="4">‚òÖ</span>
                                    <span class="star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="valueRating" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="comment">Review Comment:</label>
                            <textarea id="comment" rows="4" class="input" placeholder="Tell us about your experience..."
                                required></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Contractor Details Modal -->
        <div class="modal" id="contractorModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Contractor Details</h2>
                    <span class="close close-contractor-modal">&times;</span>
                </div>
                <div class="modal-body" id="contractorDetails">
                    <!-- Contractor details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Quick Actions Footer -->
        <footer class="app-footer">
            <div class="footer-actions">
                <button class="btn btn-secondary" data-action="view-favorites">
                    <i class="fas fa-heart"></i> View Favorites
                </button>
                <button class="btn btn-secondary" data-action="export-favorites">
                    <i class="fas fa-download"></i> Export Favorites
                </button>
                <button class="btn btn-secondary" data-action="import-favorites">
                    <i class="fas fa-upload"></i> Import Favorites
                </button>
                <button class="btn btn-secondary" data-action="export-data">
                    <i class="fas fa-file-export"></i> Export All Data
                </button>
                <input type="file" id="importFavorites" accept=".json" class="hidden">
            </div>
            <p class="footer-note">
                Your favorites are stored locally in this browser. Export to backup your data.
            </p>
        </footer>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Core Modules -->
    <script src="js/modules/utils.js"></script>
    <script src="js/modules/storage.js"></script>
    <script src="js/data/defaultData.js"></script>
    <script src="js/modules/categories.js"></script>
    <script src="js/modules/contractorManager.js"></script>
    <script src="js/modules/reviewManager.js"></script>
    <script src="js/modules/statsManager.js"></script>
    <script src="js/modules/favoritesManager.js"></script>
    <script src="js/modules/mapManager.js"></script>
    <script src="js/modules/data.js"></script>

    <!-- App Modules (LOAD BEFORE script.js) -->
    <script src="js/app/main.js"></script>
    <script src="js/app/uiManager.js"></script>
    <script src="js/app/modalManager.js"></script>
    <script src="js/app/filterManager.js"></script>
    <script src="js/app/formManager.js"></script>

    <!-- Main Script (LOAD LAST) -->
    <script src="js/script.js"></script>
</body>

</html>