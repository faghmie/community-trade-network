<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contractor Reviews | Find Trusted Professionals</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚≠ê</text></svg>">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body class="material-theme">
    <!-- App Bar -->
    <header class="app-bar">
        <div class="app-bar-content">
            <div class="app-bar-title">
                <i class="material-icons app-bar-icon">construction</i>
                <h1>Contractor Reviews</h1>
            </div>
            <nav class="app-bar-actions">
                <a href="admin.html" class="btn btn-secondary btn-small">
                    <i class="material-icons">admin_panel_settings</i>
                    <span>Admin</span>
                </a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h2 class="hero-title">Find Trusted Local Contractors</h2>
                <p class="hero-subtitle">Read reviews, compare ratings, and connect with the best professionals in your
                    area</p>
            </div>
        </section>

        <!-- Search and Filter Section -->
        <section class="dashboard-controls material-card">
            <!-- Quick Filters -->
            <div class="quick-filters">
                <!-- FIXED: Moved search inside quick-filters to make it inline -->
                <div class="material-search-container">
                    <div class="material-search">
                        <i class="material-icons">search</i>
                        <input type="text" id="searchInput" placeholder="Search contractors..."
                            class="material-search-input" data-action="search-keypress">
                    </div>
                </div>

                <div class="filter-chip-group">
                    <select id="locationFilter" class="material-select filter-chip" data-action="filter">
                        <option value="">üìç All Locations</option>
                        <!-- Locations will be populated dynamically -->
                    </select>

                    <select id="categoryFilter" class="material-select filter-chip" data-action="filter">
                        <option value="">All Categories</option>
                        <!-- Categories will be populated dynamically -->
                    </select>

                    <!-- FIXED: Updated to use new button classes -->
                    <button class="btn btn-toggle" id="toggleFiltersBtn" data-action="toggle-filters">
                        <i class="material-icons">filter_list</i>
                        <span>More Filters</span>
                        <span class="filter-badge material-badge" id="activeFilterCount">0</span>
                    </button>

                    <!-- FIXED: Updated to use new button classes -->
                    <button class="btn btn-text btn-small" data-action="clear-filters"
                        title="Clear all filters">
                        <i class="material-icons">clear</i>
                        <span>Clear</span>
                    </button>

                    <!-- FIXED: Removed view-toggle-container wrapper to make it truly inline -->
                    <div class="view-toggle" id="view-toggle">
                        <!-- FIXED: Added view-toggle-btn class for CSS compatibility -->
                        <button class="btn btn-toggle view-toggle-btn" data-view="list" title="List View">
                            <i class="material-icons">view_list</i>
                        </button>
                        <!-- FIXED: Added view-toggle-btn class for CSS compatibility -->
                        <button class="btn btn-toggle view-toggle-btn" data-view="map" title="Map View">
                            <i class="material-icons">map</i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-filters material-expansion hidden" id="advancedFilters">
                <div class="expansion-header">
                    <h4>Advanced Filters</h4>
                    <i class="material-icons expansion-icon">expand_more</i>
                </div>

                <div class="expansion-content">
                    <!-- Quick Presets -->
                    <div class="quick-presets">
                        <div class="preset-buttons">
                            <!-- FIXED: Updated to use new button classes -->
                            <button class="btn btn-secondary btn-small" data-action="show-favorites">
                                <i class="material-icons">favorite</i>
                                <span>Show Favorites</span>
                            </button>
                            <!-- FIXED: Updated to use new button classes -->
                            <button class="btn btn-secondary btn-small" data-action="show-high-rated">
                                <i class="material-icons">star</i>
                                <span>Show Top Rated</span>
                            </button>
                        </div>
                    </div>

                    <div class="advanced-filter-grid">
                        <div class="material-form-group">
                            <label for="ratingFilter" class="material-input-label">
                                <i class="material-icons">star</i>
                                Minimum Rating
                            </label>
                            <select id="ratingFilter" class="material-select" data-action="filter">
                                <option value="">All Ratings</option>
                                <option value="4.5">4.5+ Stars</option>
                                <option value="4.0">4.0+ Stars</option>
                                <option value="3.5">3.5+ Stars</option>
                                <option value="3.0">3.0+ Stars</option>
                            </select>
                        </div>

                        <div class="material-form-group">
                            <label for="sortBy" class="material-input-label">
                                <i class="material-icons">sort</i>
                                Sort By
                            </label>
                            <select id="sortBy" class="material-select" data-action="sort">
                                <option value="name">Name (A-Z)</option>
                                <option value="rating">Highest Rated</option>
                                <option value="reviews">Most Reviews</option>
                                <option value="location">Location</option>
                                <option value="favorites">Favorites First</option>
                            </select>
                        </div>

                        <div class="material-form-group">
                            <label for="favoritesFilter" class="material-input-label">
                                <i class="material-icons">favorite</i>
                                Favorites
                            </label>
                            <select id="favoritesFilter" class="material-select" data-action="filter">
                                <option value="">All Contractors</option>
                                <option value="favorites">Favorites Only</option>
                                <option value="non-favorites">Not in Favorites</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Overview -->
            <div class="stats-overview">
                <!-- FIXED: Removed material-card class from stat cards -->
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="material-icons">groups</i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="totalContractorsCount">0</span>
                        <span class="stat-label">Contractors</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="material-icons">reviews</i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="totalReviewsCount">0</span>
                        <span class="stat-label">Reviews</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="material-icons">star</i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="averageRatingCount">0.0</span>
                        <span class="stat-label">Avg Rating</span>
                    </div>
                </div>
                <div class="stat-card favorites-stat">
                    <div class="stat-icon">
                        <i class="material-icons">favorite</i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number favorites-count">0</span>
                        <span class="stat-label">Favorites</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Map Container -->
        <section class="map-section">
            <div id="map-container" class="map-container material-card hidden"></div>
        </section>

        <!-- Favorites Section -->
        <section id="favoritesSection" class="favorites-section material-card hidden">
            <div class="section-header">
                <div class="section-title">
                    <i class="material-icons">favorite</i>
                    <h2>Your Favorite Contractors</h2>
                </div>
                <span class="material-badge favorites-badge">0</span>
            </div>
            <div id="favoritesNotice">
                <!-- Favorites notice will be populated dynamically -->
            </div>
            <div class="grid grid-3" id="favoritesGrid">
                <!-- Favorite contractors will be loaded here -->
            </div>
        </section>

        <!-- Contractor List -->
        <section class="contractor-list material-card" id="contractorList">
            <div class="section-header">
                <h2>Available Contractors</h2>
            </div>
            <div class="grid grid-3" id="contractorsGrid">
                <!-- Contractors will be loaded here -->
            </div>
        </section>

        <!-- Review Form Modal -->
        <div class="modal material-modal" id="reviewModal">
            <div class="modal-content material-modal-content">
                <div class="modal-header material-modal-header">
                    <h2>Leave a Review</h2>
                    <button class="material-icon-button close" id="closeModal">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body material-modal-body">
                    <form id="reviewForm" class="material-form">
                        <input type="hidden" id="contractorId">

                        <div class="material-form-group">
                            <label for="reviewerName" class="material-input-label">Your Name</label>
                            <input type="text" id="reviewerName" class="material-input" required>
                        </div>

                        <div class="material-form-group">
                            <label for="projectType" class="material-input-label">Project Type</label>
                            <select id="projectType" class="material-select" required>
                                <option value="">Select Project Type</option>
                                <option value="bathroom-renovation">Bathroom Renovation</option>
                                <option value="kitchen-remodel">Kitchen Remodel</option>
                                <option value="plumbing">Plumbing Work</option>
                                <option value="electrical">Electrical Work</option>
                                <option value="painting">Painting</option>
                                <option value="flooring">Flooring</option>
                                <option value="roofing">Roofing</option>
                                <option value="general-construction">General Construction</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Overall Rating -->
                        <div class="material-form-group">
                            <label class="material-input-label">Overall Rating</label>
                            <div class="material-star-rating overall-rating">
                                <span class="material-star" data-rating="1">‚òÖ</span>
                                <span class="material-star" data-rating="2">‚òÖ</span>
                                <span class="material-star" data-rating="3">‚òÖ</span>
                                <span class="material-star" data-rating="4">‚òÖ</span>
                                <span class="material-star" data-rating="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="rating" required>
                        </div>

                        <!-- Category Ratings -->
                        <div class="rating-categories">
                            <h4 class="rating-categories-title">Rate by Category</h4>

                            <div class="material-rating-category">
                                <label>Quality of Work</label>
                                <div class="material-star-rating quality-rating">
                                    <span class="material-star" data-rating="1">‚òÖ</span>
                                    <span class="material-star" data-rating="2">‚òÖ</span>
                                    <span class="material-star" data-rating="3">‚òÖ</span>
                                    <span class="material-star" data-rating="4">‚òÖ</span>
                                    <span class="material-star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="qualityRating" required>
                            </div>

                            <div class="material-rating-category">
                                <label>Communication</label>
                                <div class="material-star-rating communication-rating">
                                    <span class="material-star" data-rating="1">‚òÖ</span>
                                    <span class="material-star" data-rating="2">‚òÖ</span>
                                    <span class="material-star" data-rating="3">‚òÖ</span>
                                    <span class="material-star" data-rating="4">‚òÖ</span>
                                    <span class="material-star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="communicationRating" required>
                            </div>

                            <div class="material-rating-category">
                                <label>Timeliness</label>
                                <div class="material-star-rating timeliness-rating">
                                    <span class="material-star" data-rating="1">‚òÖ</span>
                                    <span class="material-star" data-rating="2">‚òÖ</span>
                                    <span class="material-star" data-rating="3">‚òÖ</span>
                                    <span class="material-star" data-rating="4">‚òÖ</span>
                                    <span class="material-star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="timelinessRating" required>
                            </div>

                            <div class="material-rating-category">
                                <label>Value for Money</label>
                                <div class="material-star-rating value-rating">
                                    <span class="material-star" data-rating="1">‚òÖ</span>
                                    <span class="material-star" data-rating="2">‚òÖ</span>
                                    <span class="material-star" data-rating="3">‚òÖ</span>
                                    <span class="material-star" data-rating="4">‚òÖ</span>
                                    <span class="material-star" data-rating="5">‚òÖ</span>
                                </div>
                                <input type="hidden" id="valueRating" required>
                            </div>
                        </div>

                        <div class="material-form-group">
                            <label for="comment" class="material-input-label">Review Comment</label>
                            <textarea id="comment" rows="4" class="material-textarea"
                                placeholder="Tell us about your experience..." required></textarea>
                        </div>

                        <!-- FIXED: Updated to use new button classes -->
                        <button type="submit" class="btn btn-primary">
                            <i class="material-icons">send</i>
                            <span>Submit Review</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Contractor Details Modal -->
        <div class="modal material-modal" id="contractorModal">
            <div class="modal-content material-modal-content">
                <div class="modal-header material-modal-header">
                    <h2>Contractor Details</h2>
                    <button class="material-icon-button close close-contractor-modal">
                        <i class="material-icons">close</i>
                    </button>
                </div>
                <div class="modal-body material-modal-body" id="contractorDetails">
                    <!-- Contractor details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Quick Actions Footer -->
        <footer class="app-footer material-footer">
            <div class="footer-actions">
                <!-- FIXED: Updated to use new button classes -->
                <button class="btn btn-secondary btn-small" data-action="view-favorites">
                    <i class="material-icons">favorite</i>
                    <span>View Favorites</span>
                </button>
                <!-- FIXED: Updated to use new button classes -->
                <button class="btn btn-secondary btn-small" data-action="export-favorites">
                    <i class="material-icons">download</i>
                    <span>Export Favorites</span>
                </button>
                <!-- FIXED: Updated to use new button classes -->
                <button class="btn btn-secondary btn-small" data-action="import-favorites">
                    <i class="material-icons">upload</i>
                    <span>Import Favorites</span>
                </button>
                <!-- FIXED: Updated to use new button classes -->
                <button class="btn btn-secondary btn-small" data-action="export-data">
                    <i class="material-icons">file_export</i>
                    <span>Export All Data</span>
                </button>
                <input type="file" id="importFavorites" accept=".json" class="hidden">
            </div>
            <p class="footer-note">
                <i class="material-icons">info</i>
                Your favorites are stored locally in this browser. Export to backup your data.
            </p>
        </footer>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Core Modules -->
    <script src="js/modules/utils.js"></script>
    <script src="js/modules/storage.js"></script>
    <script src="js/data/defaultData.js"></script>
    <script src="js/modules/categories.js"></script>
    <script src="js/modules/contractorManager.js"></script>
    <script src="js/modules/reviewManager.js"></script>
    <script src="js/modules/statsManager.js"></script>
    <script src="js/modules/favoritesManager.js"></script>
    <script src="js/modules/mapManager.js"></script>
    <script src="js/modules/cardManager.js"></script>
    <script src="js/modules/data.js"></script>

    <!-- App Modules (LOAD BEFORE script.js) -->
    <script src="js/app/main.js"></script>
    <script src="js/app/uiManager.js"></script>
    <script src="js/app/modalManager.js"></script>
    <script src="js/app/filterManager.js"></script>
    <script src="js/app/formManager.js"></script>

    <!-- Main Script (LOAD LAST) -->
    <script src="js/script.js"></script>
</body>

</html>